<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mis Usados | Tienda Oficial</title>
    <style>
        :root {
            --primario: #1a1a1a;
            --acento: #007bff;
            --fondo: #f4f7f6;
        }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--fondo); scroll-behavior: smooth; }
        header { background: var(--primario); color: white; padding: 40px; text-align: center; border-bottom: 5px solid var(--acento); }
        .vitrina-container { max-width: 1200px; margin: 40px auto; position: relative; padding: 0 60px; }
        .visor { overflow: hidden; border-radius: 15px; min-height: 400px; }
        .grid-productos { display: flex; transition: transform 0.5s ease; gap: 20px; padding: 20px 0; }
        .tarjeta { min-width: 280px; background: white; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden; display: flex; flex-direction: column; }
        .img-contenedor { width: 100%; height: 200px; background: #eee; overflow: hidden; }
        .tarjeta img { width: 100%; height: 100%; object-fit: cover; }
        .contenido { padding: 20px; text-align: center; }
        .precio { font-size: 1.4rem; font-weight: bold; color: var(--acento); }
        .badge { font-size: 0.75rem; padding: 5px 12px; border-radius: 50px; font-weight: bold; margin-bottom: 10px; display: inline-block; }
        .alto { background: #d4edda; color: #155724; }
        .btn-pedido { background: var(--acento); color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        .btn-nav { position: absolute; top: 50%; transform: translateY(-50%); background: white; border: 2px solid var(--primario); width: 45px; height: 45px; border-radius: 50%; cursor: pointer; z-index: 10; }
        .btn-prev { left: 5px; } .btn-next { right: 5px; }
        #mensaje-estado { text-align: center; padding: 50px; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <h1>Mis Usados</h1>
    <p>Cat치logo en Tiempo Real</p>
</header>

<div class="vitrina-container">
    <button class="btn-nav btn-prev" onclick="mover(-1)">&#10094;</button>
    <button class="btn-nav btn-next" onclick="mover(1)">&#10095;</button>
    <div class="visor">
        <div id="mensaje-estado">Cargando productos...</div>
        <div class="grid-productos" id="catalogo"></div>
    </div>
</div>

<script>
    const URL_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS3fcYWk6ira5SgkWGjS5-tVBvFAMPGUS9ggADgr-Wg8OzWRZGU47SehGfNIFc3EA/pub?output=csv";
    let productos = [];
    let scrollPos = 0;

    // Funci칩n para convertir enlaces de Drive en im치genes directas
    function corregirImagen(url) {
        if (!url) return "https://via.placeholder.com/300?text=Sin+Imagen";
        if (url.includes("picsum.photos")) return url;
        
        let id = "";
        if (url.includes("id=")) {
            id = url.split("id=")[1].split("&")[0];
        } else if (url.includes("/d/")) {
            id = url.split("/d/")[1].split("/")[0];
        }
        
        return id ? `https://lh3.googleusercontent.com/u/0/d/${id}` : url;
    }

    async function cargarDatos() {
        try {
            const res = await fetch(URL_CSV + "&t=" + new Date().getTime());
            const csv = await res.text();
            const filas = csv.split(/\r?\n/).slice(1);
            
            productos = filas.map(f => {
                const c = f.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return {
                    nombre: c[0]?.replace(/"/g, '').trim(),
                    precio: c[1]?.replace(/"/g, '').trim(),
                    img: corregirImagen(c[2]?.replace(/"/g, '').trim()),
                    stock: parseInt(c[3]) || 0
                };
            }).filter(p => p.nombre);

            document.getElementById('mensaje-estado').style.display = "none";
            renderizar();
        } catch (e) {
            document.getElementById('mensaje-estado').innerHTML = "Error al conectar con el cat치logo.";
        }
    }

    function renderizar() {
        const contenedor = document.getElementById('catalogo');
        contenedor.innerHTML = "";
        productos.forEach(p => {
            const card = document.createElement('div');
            card.className = 'tarjeta';
            card.innerHTML = `
                <div class="img-contenedor">
                    <img src="${p.img}" onerror="this.src='https://via.placeholder.com/300?text=Error+de+Carga'">
                </div>
                <div class="contenido">
                    <span class="badge ${p.stock > 0 ? 'alto' : 'agotado'}">Stock: ${p.stock}</span>
                    <h3>${p.nombre}</h3>
                    <p class="precio">${p.precio}</p>
                    <button class="btn-pedido" ${p.stock <= 0 ? 'disabled' : ''}>Seleccionar</button>
                </div>
            `;
            contenedor.appendChild(card);
        });
    }

    function mover(dir) {
        const ancho = 300;
        scrollPos += (dir * -ancho);
        const limite = (productos.length - 1) * ancho;
        if (scrollPos < -limite) scrollPos = -limite;
        if (scrollPos > 0) scrollPos = 0;
        document.getElementById('catalogo').style.transform = `translateX(${scrollPos}px)`;
    }

    window.onload = cargarDatos;
</script>
</body>
</html>
